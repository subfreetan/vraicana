<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Burger - Commande en ligne</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Bebas Neue', 'Impact', 'Arial Black', sans-serif;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            color: #dc2626;
            font-size: 64px;
            font-weight: 400;
            margin-bottom: 5px;
            text-align: center;
            letter-spacing: 3px;
            text-transform: uppercase;
            font-style: italic;
            text-shadow: 3px 3px 0px #000, 
                         -1px -1px 0px #fff,
                         2px 2px 8px rgba(220, 38, 38, 0.4);
            transform: skewY(-2deg);
        }

        .subtitle {
            font-family: 'Bebas Neue', sans-serif;
            text-align: center;
            color: #000;
            font-size: 16px;
            margin-bottom: 30px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h2 {
            font-family: 'Bebas Neue', sans-serif;
            color: #1a1a1a;
            margin: 30px 0 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid transparent;
            background: linear-gradient(to right, #dc2626, #991b1b);
            background-size: 100% 3px;
            background-repeat: no-repeat;
            background-position: bottom;
            font-weight: 400;
            font-size: 40px;
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 2px;
            transform: skewY(-1deg);
        }

        .nav {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 16px;
        }

        .nav button {
            font-family: 'Bebas Neue', sans-serif;
            padding: 12px 24px;
            background: white;
            color: #1a1a1a;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 400;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex: 1;
            min-width: 120px;
            letter-spacing: 1px;
        }

        .nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
        }

        .nav button.active {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }

        .section {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section.active {
            display: block;
        }

        .profile-card {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.3);
        }

        .profile-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .profile-info h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            font-weight: 400;
            letter-spacing: 1px;
        }

        .points-badge {
            font-family: 'Bebas Neue', sans-serif;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 24px;
            font-weight: 400;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }

        #qrcode {
            margin: 20px auto;
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 16px;
            display: inline-block;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .menu-item {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .menu-item:hover::before {
            transform: scaleX(1);
        }

        .menu-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(220, 38, 38, 0.2);
            border-color: #dc2626;
        }

        .menu-item h3 {
            font-family: 'Bebas Neue', sans-serif;
            color: #dc2626;
            margin-bottom: 12px;
            font-size: 28px;
            font-weight: 400;
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 1px;
        }

        .menu-item p {
            color: #666;
            margin: 8px 0;
            font-size: 15px;
        }

        .menu-item button {
            font-family: 'Bebas Neue', sans-serif;
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 12px;
            font-weight: 400;
            font-size: 18px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 1px;
        }

        .menu-item button:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }

        .cart-item {
            background: white;
            border: 2px solid #f0f0f0;
            padding: 20px;
            margin: 12px 0;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            border-color: #dc2626;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
        }

        .cart-item button {
            font-family: 'Bebas Neue', sans-serif;
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 400;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            font-size: 16px;
        }

        .cart-item button:hover {
            background: #ff3838;
            transform: scale(1.05);
        }

        .cart-total {
            font-family: 'Bebas Neue', sans-serif;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            font-size: 24px;
            font-weight: 400;
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 2px;
        }

        .btn-primary {
            font-family: 'Bebas Neue', sans-serif;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 20px;
            font-weight: 400;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 2px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        .order-qr {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            margin-top: 20px;
            border: 2px solid #dc2626;
        }

        .admin-login {
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .admin-login input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .admin-login input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .order-card {
            background: white;
            border: 2px solid #f0f0f0;
            border-left: 4px solid #dc2626;
            padding: 20px;
            margin: 15px 0;
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .order-card:hover {
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.15);
            transform: translateX(4px);
        }

        .order-items {
            margin: 15px 0;
            padding-left: 20px;
            color: #666;
        }

        #reader {
            max-width: 500px;
            margin: 20px auto;
            border-radius: 16px;
            overflow: hidden;
        }

        .scanned-order {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 30px;
            margin: 20px 0;
            border-radius: 20px;
            border: 2px solid #2196f3;
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.2);
        }

        .success-message {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .reward-card {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 20px 60px rgba(220, 38, 38, 0.4);
            position: relative;
            overflow: hidden;
        }

        .reward-card::before {
            content: '‚ú®';
            position: absolute;
            font-size: 100px;
            opacity: 0.1;
            top: -20px;
            right: -20px;
        }

        .reward-card h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 42px;
            margin-bottom: 20px;
            font-weight: 400;
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 3px;
        }

        .reward-card p {
            font-size: 18px;
            margin: 15px 0;
            opacity: 0.95;
        }

        .reward-card button {
            font-family: 'Bebas Neue', sans-serif;
            background: white;
            color: #dc2626;
            padding: 16px 40px;
            border: none;
            border-radius: 50px;
            font-size: 22px;
            font-weight: 400;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-transform: uppercase;
            font-style: italic;
            letter-spacing: 2px;
        }

        .reward-card button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .reward-card button:disabled {
            background: rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            cursor: not-allowed;
            transform: none;
        }

        .toast {
            font-family: 'Bebas Neue', sans-serif;
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 16px 28px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            z-index: 1000;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 400;
            backdrop-filter: blur(10px);
            font-size: 18px;
            letter-spacing: 1px;
        }

        .toast.preparing {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4);
        }

        .toast.error {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            box-shadow: 0 8px 25px rgba(244, 67, 54, 0.4);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .server-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .server-config input {
            padding: 12px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-right: 10px;
            width: 300px;
        }

        .server-config button {
            font-family: 'Bebas Neue', sans-serif;
            padding: 12px 24px;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .server-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }

        .server-status.connected {
            background: #4caf50;
            color: white;
        }

        .server-status.disconnected {
            background: #f44336;
            color: white;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Historique des points */
        .history-card {
            background: white;
            border: 2px solid #f0f0f0;
            border-left: 4px solid #dc2626;
            padding: 20px;
            margin: 15px 0;
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .history-card:hover {
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.15);
            transform: translateX(4px);
        }

        .history-card.clickcollect {
            border-left-color: #2196f3;
        }

        .history-card.prepare {
            border-left-color: #4caf50;
        }

        .history-card.reward {
            border-left-color: #ff9800;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .history-type {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 6px 14px;
            border-radius: 20px;
            color: white;
        }

        .history-type.clickcollect {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
        }

        .history-type.prepare {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .history-type.reward {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .history-points {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            color: #dc2626;
            font-weight: 400;
        }

        .history-points.negative {
            color: #ff9800;
        }

        .history-date {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .history-items {
            color: #666;
            font-size: 15px;
            padding-left: 10px;
            border-left: 2px solid #eee;
            margin-top: 10px;
        }

        .history-empty {
            text-align: center;
            padding: 40px;
            color: #888;
            font-size: 18px;
        }

        /* Syst√®me d'authentification */
        .profile-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }

        .auth-section {
            flex: 1;
            min-width: 280px;
            max-width: 350px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .auth-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            text-align: center;
            margin-bottom: 15px;
            color: white;
            letter-spacing: 1px;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .auth-tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .auth-tab.active {
            background: white;
            color: #dc2626;
        }

        .auth-form-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .auth-input {
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .auth-input:focus {
            outline: none;
            border-color: white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .password-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-wrapper .auth-input {
            padding-right: 45px;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
        }

        .auth-btn {
            padding: 14px;
            background: white;
            color: #dc2626;
            border: none;
            border-radius: 10px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .auth-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .auth-error {
            background: #ff4757;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
        }

        .auth-success {
            background: #4caf50;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
        }

        /* Profil connect√© */
        .user-info-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
        }

        .user-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-info-row:last-of-type {
            border-bottom: none;
        }

        .user-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .user-value {
            color: white;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-password-small {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            padding: 4px 8px;
            transition: all 0.3s ease;
        }

        .toggle-password-small:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modify-btn {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            padding: 10px;
        }

        .modify-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .logout-btn {
            margin-top: 10px;
            background: #ff4757;
            color: white;
        }

        .logout-btn:hover {
            background: #ff3838;
        }

        .modify-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .save-btn {
            flex: 1;
            background: #4caf50;
            color: white;
            font-size: 14px;
            padding: 10px;
        }

        .save-btn:hover {
            background: #45a049;
        }

        .cancel-btn {
            flex: 1;
            background: #888;
            color: white;
            font-size: 14px;
            padding: 10px;
        }

        .cancel-btn:hover {
            background: #666;
        }

        #modifyPasswordForm {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        #modifyPasswordForm .auth-input {
            margin-bottom: 0;
        }

        /* Boutons de paiement */
        .payment-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-payment {
            flex: 1;
            min-width: 200px;
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 18px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-bancontact {
            background: linear-gradient(135deg, #005498 0%, #003d6b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 84, 152, 0.3);
        }

        .btn-bancontact:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 84, 152, 0.4);
        }

        .btn-especes {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }

        .btn-especes:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 125, 50, 0.4);
        }

        .btn-payment-icon {
            font-size: 24px;
        }

        /* ============================================
           SUPER ADMIN - MODE SOMBRE
           ============================================ */
        
        .dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%) !important;
        }

        .dark-mode .container {
            background: rgba(30, 30, 50, 0.98);
            color: #e0e0e0;
        }

        .dark-mode h1 {
            color: #8b5cf6;
            text-shadow: 3px 3px 0px #000, 
                         -1px -1px 0px #4c1d95,
                         2px 2px 8px rgba(139, 92, 246, 0.5);
        }

        .dark-mode h2 {
            color: #e0e0e0;
            background: linear-gradient(to right, #8b5cf6, #6d28d9);
            background-size: 100% 3px;
            background-repeat: no-repeat;
            background-position: bottom;
        }

        .dark-mode .nav {
            background: #252542;
        }

        .dark-mode .nav button {
            background: #1a1a2e;
            color: #e0e0e0;
            border: 2px solid #3d3d5c;
        }

        .dark-mode .nav button:hover {
            background: #2d2d4a;
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.2);
        }

        .dark-mode .nav button.active {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
            border-color: transparent;
        }

        .dark-mode .profile-card {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .dark-mode .server-config {
            background: #252542;
            border-color: #3d3d5c;
            color: #e0e0e0;
        }

        .dark-mode .server-config input {
            background: #1a1a2e;
            border-color: #3d3d5c;
            color: #e0e0e0;
        }

        .dark-mode .server-config button {
            background: #8b5cf6;
        }

        .dark-mode .menu-item {
            background: #252542;
            border-color: #3d3d5c;
        }

        .dark-mode .menu-item::before {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
        }

        .dark-mode .menu-item:hover {
            border-color: #8b5cf6;
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
        }

        .dark-mode .menu-item h3 {
            color: #a78bfa;
        }

        .dark-mode .menu-item p {
            color: #9ca3af;
        }

        .dark-mode .menu-item button {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
        }

        .dark-mode .menu-item button:hover {
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
        }

        .dark-mode .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .dark-mode .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .dark-mode .cart-item {
            background: #252542;
            border-color: #3d3d5c;
            color: #e0e0e0;
        }

        .dark-mode .cart-item:hover {
            border-color: #8b5cf6;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
        }

        .dark-mode .cart-total {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }

        .dark-mode .order-card {
            background: #252542;
            border-color: #3d3d5c;
            border-left-color: #8b5cf6;
            color: #e0e0e0;
        }

        .dark-mode .order-card:hover {
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
        }

        .dark-mode .order-items {
            color: #9ca3af;
        }

        .dark-mode .reward-card {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 0 20px 60px rgba(139, 92, 246, 0.4);
        }

        .dark-mode .reward-card button {
            background: white;
            color: #6d28d9;
        }

        .dark-mode .admin-login {
            background: #252542;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .admin-login h2 {
            color: #e0e0e0;
        }

        .dark-mode .admin-login input {
            background: #1a1a2e;
            border-color: #3d3d5c;
            color: #e0e0e0;
        }

        .dark-mode .admin-login input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .dark-mode .history-card {
            background: #252542;
            border-color: #3d3d5c;
            border-left-color: #8b5cf6;
            color: #e0e0e0;
        }

        .dark-mode .history-card:hover {
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
        }

        .dark-mode .history-points {
            color: #a78bfa;
        }

        .dark-mode .history-date {
            color: #6b7280;
        }

        .dark-mode .history-items {
            color: #9ca3af;
            border-left-color: #3d3d5c;
        }

        .dark-mode .scanned-order {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-color: #8b5cf6;
            color: #e0e0e0;
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
        }

        .dark-mode .order-qr {
            background: linear-gradient(135deg, #252542 0%, #1a1a2e 100%);
            border-color: #8b5cf6;
        }

        .dark-mode .auth-section {
            background: rgba(139, 92, 246, 0.15);
        }

        .dark-mode .points-badge {
            background: rgba(139, 92, 246, 0.3);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .dark-mode .toast {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        /* Badge Super Admin */
        .super-admin-badge {
            display: inline-block;
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 16px;
            letter-spacing: 2px;
            margin-left: 15px;
            animation: pulse-glow 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            }
            50% {
                box-shadow: 0 4px 25px rgba(139, 92, 246, 0.7);
            }
        }

        /* Super Admin Panel Extra Styles */
        .dark-mode .super-admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dark-mode .stat-card {
            background: linear-gradient(135deg, #252542 0%, #1a1a2e 100%);
            border: 2px solid #3d3d5c;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .dark-mode .stat-card:hover {
            border-color: #8b5cf6;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.2);
        }

        .dark-mode .stat-card .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 48px;
            color: #a78bfa;
            display: block;
        }

        .dark-mode .stat-card .stat-label {
            color: #9ca3af;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .dark-mode .danger-zone {
            background: linear-gradient(135deg, #450a0a 0%, #7f1d1d 100%);
            border: 2px solid #dc2626;
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
        }

        .dark-mode .danger-zone h3 {
            color: #fca5a5;
            margin-bottom: 15px;
        }

        .dark-mode .danger-btn {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .dark-mode .danger-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçî CANADIAN BURGER</h1>
        <div class="subtitle">par Despa et Yasser Ghourdou</div>

        <!-- Configuration du serveur -->
        <div class="server-config">
            <label><strong>URL du serveur JSON:</strong></label><br><br>
            <input type="text" id="serverUrl" value="https://canadian-burger.onrender.com" placeholder="https://canadian-burger.onrender.com">
            <button onclick="testConnection()">Tester la connexion</button>
            <span id="serverStatus" class="server-status disconnected">D√©connect√©</span>
        </div>

        <div class="nav">
            <button onclick="showSection('profile')" class="active">Mon Profil</button>
            <button onclick="showSection('menu')">Menu</button>
            <button onclick="showSection('clickcollect')">Click & Collect</button>
            <button onclick="showSection('prepare')">Pr√©parer ma commande</button>
            <button onclick="showSection('rewards')">R√©compenses</button>
            <button onclick="showSection('admin')">Admin</button>
        </div>

        <!-- PROFIL -->
        <div id="profile" class="section active">
            <h2>Mon Profil</h2>
            <div class="profile-card">
                <div class="profile-info">
                    <div>
                        <h3>ID Client: <span id="userId">12345</span></h3>
                    </div>
                    <div class="points-badge">
                        <span id="userPoints">0</span> Points
                    </div>
                </div>
                <div class="profile-content">
                    <div id="qrcode"></div>
                    
                    <!-- Zone Connexion/Inscription -->
                    <div class="auth-section">
                        <!-- Formulaire non connect√© -->
                        <div id="authForm">
                            <h3 class="auth-title">üë§ Mon Compte</h3>
                            
                            <div class="auth-tabs">
                                <button class="auth-tab active" onclick="showAuthTab('login')">Connexion</button>
                                <button class="auth-tab" onclick="showAuthTab('register')">Inscription</button>
                            </div>
                            
                            <!-- Connexion -->
                            <div id="loginForm" class="auth-form-content">
                                <input type="text" id="loginPseudo" placeholder="Pseudo" class="auth-input">
                                <div class="password-wrapper">
                                    <input type="password" id="loginPassword" placeholder="Mot de passe" class="auth-input">
                                    <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
                                </div>
                                <button class="auth-btn" onclick="loginUser()">Se connecter</button>
                            </div>
                            
                            <!-- Inscription -->
                            <div id="registerForm" class="auth-form-content" style="display:none;">
                                <input type="text" id="registerPseudo" placeholder="Choisir un pseudo" class="auth-input">
                                <div class="password-wrapper">
                                    <input type="password" id="registerPassword" placeholder="Choisir un mot de passe" class="auth-input">
                                    <button type="button" class="toggle-password" onclick="togglePassword('registerPassword')">üëÅÔ∏è</button>
                                </div>
                                <button class="auth-btn" onclick="registerUser()">S'inscrire</button>
                            </div>
                            
                            <div id="authError" class="auth-error" style="display:none;"></div>
                            <div id="authSuccess" class="auth-success" style="display:none;"></div>
                        </div>
                        
                        <!-- Profil connect√© -->
                        <div id="userProfile" style="display:none;">
                            <h3 class="auth-title">üë§ Connect√©</h3>
                            <div class="user-info-card">
                                <div class="user-info-row">
                                    <span class="user-label">Pseudo:</span>
                                    <span class="user-value" id="displayPseudo">-</span>
                                </div>
                                <div class="user-info-row">
                                    <span class="user-label">Mot de passe:</span>
                                    <span class="user-value">
                                        <span id="displayPassword">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                                        <button class="toggle-password-small" onclick="toggleDisplayPassword()">üëÅÔ∏è</button>
                                    </span>
                                </div>
                                <button class="auth-btn modify-btn" onclick="showModifyPassword()">‚úèÔ∏è Modifier mot de passe</button>
                                
                                <!-- Formulaire modification mot de passe -->
                                <div id="modifyPasswordForm" style="display:none;">
                                    <div class="password-wrapper">
                                        <input type="password" id="newPassword" placeholder="Nouveau mot de passe" class="auth-input">
                                        <button type="button" class="toggle-password" onclick="togglePassword('newPassword')">üëÅÔ∏è</button>
                                    </div>
                                    <div class="modify-buttons">
                                        <button class="auth-btn save-btn" onclick="saveNewPassword()">üíæ Sauvegarder</button>
                                        <button class="auth-btn cancel-btn" onclick="cancelModifyPassword()">‚úñÔ∏è Annuler</button>
                                    </div>
                                </div>
                                
                                <button class="auth-btn logout-btn" onclick="logoutUser()">üö™ Se d√©connecter</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h2>Historique des Points</h2>
            <div id="pointsHistory">
                <p>Chargement de l'historique...</p>
            </div>
        </div>

        <!-- MENU -->
        <div id="menu" class="section">
            <h2>Notre Menu</h2>
            <div class="menu-grid" id="menuGrid"></div>
        </div>

        <!-- CLICK & COLLECT -->
        <div id="clickcollect" class="section">
            <h2>Click & Collect</h2>
            <div id="ccCart"></div>
            <div id="ccTotal" class="cart-total" style="display:none;">
                Total: <span id="ccTotalPrice">0</span>‚Ç¨ | Points: <span id="ccTotalPoints">0</span>
            </div>
            <div class="payment-buttons" id="ccPaymentBtns" style="display:none;">
                <button class="btn-payment btn-bancontact" onclick="validateClickCollect('bancontact')">
                    <span class="btn-payment-icon">üí≥</span> Payer en Bancontact
                </button>
                <button class="btn-payment btn-especes" onclick="validateClickCollect('especes')">
                    <span class="btn-payment-icon">üíµ</span> Payer en Esp√®ces
                </button>
            </div>
            <div id="ccSuccess" style="display:none;"></div>
        </div>

        <!-- PREPARER COMMANDE -->
        <div id="prepare" class="section">
            <h2>Pr√©parer ma commande</h2>
            <div id="prepareCart"></div>
            <div id="prepareTotal" class="cart-total" style="display:none;">
                Total: <span id="prepareTotalPrice">0</span>‚Ç¨ | Points: <span id="prepareTotalPoints">0</span>
            </div>
            <button class="btn-primary" onclick="generateOrderQR()" id="prepareValidateBtn" style="display:none;">G√©n√©rer QR Code</button>
            <div id="orderQRSection" style="display:none;" class="order-qr">
                <h3>Scannez ce QR √† la caisse</h3>
                <div id="orderQRCode"></div>
            </div>
        </div>

        <!-- RECOMPENSES -->
        <div id="rewards" class="section">
            <h2>Mes R√©compenses</h2>
            <div class="reward-card">
                <h3>ü•§ Boisson Offerte</h3>
                <p>√âchangez vos points contre une boisson gratuite !</p>
                <p style="font-size: 22px; font-weight: bold;">Co√ªt: 50 Points</p>
                <p>Vos points: <span id="rewardsPoints">0</span></p>
                <button onclick="redeemReward()" id="redeemBtn">√âchanger</button>
            </div>
            <div id="rewardSuccess" style="display:none;"></div>
        </div>

        <!-- ADMIN -->
        <div id="admin" class="section">
            <div id="adminLogin" class="admin-login">
                <h2>Acc√®s Admin</h2>
                <input type="password" id="adminCode" placeholder="Code admin">
                <button class="btn-primary" onclick="loginAdmin()">Se connecter</button>
            </div>

            <div id="adminPanel" style="display:none;">
                <h2>Panneau Admin</h2>
                
                <h3>Commandes Click & Collect en cours</h3>
                <div id="adminOrders"></div>

                <h3 style="margin-top: 30px;">Scanner commande client</h3>
                <button class="btn-primary" onclick="startScanner()">D√©marrer le scanner</button>
                <div id="reader"></div>
                <div id="scannedOrderSection"></div>
            </div>

            <!-- SUPER ADMIN PANEL (code 1234) -->
            <div id="superAdminPanel" style="display:none;">
                <h2>Super Admin <span class="super-admin-badge">üîí ACC√àS PRIVIL√âGI√â</span></h2>
                
                <!-- Statistiques -->
                <h3>üìä Statistiques Globales</h3>
                <div class="super-admin-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="statTotalUsers">0</span>
                        <span class="stat-label">Utilisateurs</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statTotalOrders">0</span>
                        <span class="stat-label">Commandes</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statTotalRevenue">0‚Ç¨</span>
                        <span class="stat-label">Chiffre d'affaires</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statTotalPoints">0</span>
                        <span class="stat-label">Points distribu√©s</span>
                    </div>
                </div>

                <!-- Gestion des commandes -->
                <h3 style="margin-top: 30px;">üõí Toutes les commandes</h3>
                <div id="superAdminOrders"></div>

                <!-- Scanner -->
                <h3 style="margin-top: 30px;">üì∑ Scanner commande client</h3>
                <button class="btn-primary" onclick="startScanner()">D√©marrer le scanner</button>
                <div id="reader"></div>
                <div id="scannedOrderSection"></div>

                <!-- Liste des utilisateurs -->
                <h3 style="margin-top: 30px;">üë• Gestion des utilisateurs</h3>
                <div id="superAdminUsers"></div>

                <!-- Zone danger -->
                <div class="danger-zone">
                    <h3>‚ö†Ô∏è Zone Danger</h3>
                    <p style="color: #fca5a5; margin-bottom: 15px;">Ces actions sont irr√©versibles !</p>
                    <button class="danger-btn" onclick="resetAllPoints()">üîÑ R√©initialiser tous les points</button>
                    <button class="danger-btn" onclick="clearAllOrders()">üóëÔ∏è Supprimer toutes les commandes</button>
                    <button class="danger-btn" onclick="exportAllData()">üì• Exporter les donn√©es</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION JSON SERVER
        // ============================================
        
        // URL de base du serveur JSON (modifiable)
        let API_BASE_URL = 'https://canadian-burger.onrender.com';

        // Helper pour les requ√™tes API
        const api = {
            async get(endpoint) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`GET ${endpoint} error:`, error);
                    throw error;
                }
            },

            async post(endpoint, data) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`POST ${endpoint} error:`, error);
                    throw error;
                }
            },

            async put(endpoint, data) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`PUT ${endpoint} error:`, error);
                    throw error;
                }
            },

            async patch(endpoint, data) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`PATCH ${endpoint} error:`, error);
                    throw error;
                }
            },

            async delete(endpoint) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return true;
                } catch (error) {
                    console.error(`DELETE ${endpoint} error:`, error);
                    throw error;
                }
            }
        };

        // Tester la connexion au serveur
        async function testConnection() {
            const statusEl = document.getElementById('serverStatus');
            API_BASE_URL = document.getElementById('serverUrl').value.trim();
            
            try {
                statusEl.textContent = 'Test...';
                statusEl.className = 'server-status';
                
                await api.get('/users');
                
                statusEl.textContent = 'Connect√© ‚úì';
                statusEl.className = 'server-status connected';
                showToast('Connexion au serveur r√©ussie !');
                
                // Recharger les donn√©es
                await loadUserPoints();
                
            } catch (error) {
                statusEl.textContent = 'D√©connect√© ‚úó';
                statusEl.className = 'server-status disconnected';
                showToast('Erreur de connexion au serveur', 'error');
            }
        }

        // ============================================
        // DONN√âES DES PRODUITS
        // ============================================
        
        const menuItems = [
            { id: 1, name: "Kebab", price: 6.50, points: 10 },
            { id: 2, name: "Burger", price: 7.00, points: 12 },
            { id: 3, name: "Tacos", price: 8.00, points: 15 },
            { id: 4, name: "Pizza", price: 9.00, points: 18 },
            { id: 5, name: "Frites", price: 3.00, points: 5 },
            { id: 6, name: "Boisson", price: 2.00, points: 3 }
        ];

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        
        let currentUser = null;
        let loggedInUser = null; // Utilisateur connect√© (avec pseudo/mdp)
        let ccCart = [];
        let prepareCart = [];
        let html5QrCode = null;
        let passwordVisible = false; // Pour afficher/cacher le mot de passe

        // ============================================
        // INITIALISATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', async function() {
            generateUserQR();
            displayMenu();
            await testConnection();
            loadPointsHistory();
            checkLoggedInUser();
        });

        // ============================================
        // AUTHENTIFICATION
        // ============================================

        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('loginForm').style.display = tab === 'login' ? 'flex' : 'none';
            document.getElementById('registerForm').style.display = tab === 'register' ? 'flex' : 'none';
            
            hideAuthMessages();
        }

        function hideAuthMessages() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }

        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            document.getElementById('authSuccess').style.display = 'none';
        }

        function showAuthSuccess(message) {
            const successEl = document.getElementById('authSuccess');
            successEl.textContent = message;
            successEl.style.display = 'block';
            document.getElementById('authError').style.display = 'none';
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        async function registerUser() {
            const pseudo = document.getElementById('registerPseudo').value.trim();
            const password = document.getElementById('registerPassword').value;

            hideAuthMessages();

            if (!pseudo || !password) {
                showAuthError('Veuillez remplir tous les champs');
                return;
            }

            if (pseudo.length < 3) {
                showAuthError('Le pseudo doit contenir au moins 3 caract√®res');
                return;
            }

            if (password.length < 4) {
                showAuthError('Le mot de passe doit contenir au moins 4 caract√®res');
                return;
            }

            try {
                // V√©rifier si le pseudo existe d√©j√†
                let existingUsers = [];
                try {
                    existingUsers = await api.get(`/accounts?pseudo=${pseudo}`);
                } catch (e) {
                    // La collection n'existe peut-√™tre pas encore, on continue
                    console.log('Collection accounts peut-√™tre inexistante, on tente de cr√©er');
                }
                
                if (existingUsers.length > 0) {
                    showAuthError('Ce pseudo est d√©j√† utilis√©');
                    return;
                }

                // G√©n√©rer un clientId unique pour ce compte
                const clientId = 'USER_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
                
                // Cr√©er le compte
                const newAccount = await api.post('/accounts', {
                    pseudo: pseudo,
                    password: password,
                    clientId: clientId,
                    createdAt: new Date().toISOString()
                });

                // Cr√©er aussi l'entr√©e utilisateur pour les points
                await api.post('/users', {
                    clientId: clientId,
                    points: 0,
                    createdAt: new Date().toISOString()
                });

                showAuthSuccess('Inscription r√©ussie ! Vous pouvez vous connecter.');
                
                // Vider les champs
                document.getElementById('registerPseudo').value = '';
                document.getElementById('registerPassword').value = '';

                // Basculer sur l'onglet connexion apr√®s 1.5s
                setTimeout(() => {
                    document.querySelector('.auth-tab').click();
                }, 1500);

            } catch (error) {
                console.error('Erreur inscription:', error);
                showAuthError('Erreur: ' + (error.message || 'V√©rifiez que le serveur est accessible'));
            }
        }

        async function loginUser() {
            const pseudo = document.getElementById('loginPseudo').value.trim();
            const password = document.getElementById('loginPassword').value;

            hideAuthMessages();

            if (!pseudo || !password) {
                showAuthError('Veuillez remplir tous les champs');
                return;
            }

            try {
                // Chercher le compte
                const accounts = await api.get(`/accounts?pseudo=${pseudo}`);
                
                if (accounts.length === 0) {
                    showAuthError('Pseudo introuvable. Inscrivez-vous d\'abord !');
                    return;
                }

                const account = accounts[0];

                if (account.password !== password) {
                    showAuthError('Mot de passe incorrect');
                    return;
                }

                // Connexion r√©ussie
                loggedInUser = account;
                
                // Mettre √† jour le clientId avec celui du compte
                document.getElementById('userId').textContent = account.clientId;
                
                // Sauvegarder la session localement
                sessionStorage.setItem('loggedInUser', JSON.stringify(account));

                // Recharger les donn√©es utilisateur
                await loadUserPoints();
                loadPointsHistory();

                // Afficher le profil connect√©
                showLoggedInProfile();
                
                showToast(`Bienvenue ${pseudo} !`);

            } catch (error) {
                console.error('Erreur connexion:', error);
                showAuthError('Erreur lors de la connexion');
            }
        }

        function showLoggedInProfile() {
            document.getElementById('authForm').style.display = 'none';
            document.getElementById('userProfile').style.display = 'block';
            document.getElementById('displayPseudo').textContent = loggedInUser.pseudo;
            document.getElementById('displayPassword').textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            passwordVisible = false;
        }

        function checkLoggedInUser() {
            const savedUser = sessionStorage.getItem('loggedInUser');
            if (savedUser) {
                loggedInUser = JSON.parse(savedUser);
                document.getElementById('userId').textContent = loggedInUser.clientId;
                showLoggedInProfile();
            }
        }

        function toggleDisplayPassword() {
            const displayEl = document.getElementById('displayPassword');
            passwordVisible = !passwordVisible;
            
            if (passwordVisible) {
                displayEl.textContent = loggedInUser.password;
            } else {
                displayEl.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            }
        }

        function showModifyPassword() {
            document.getElementById('modifyPasswordForm').style.display = 'block';
            document.getElementById('newPassword').value = '';
        }

        function cancelModifyPassword() {
            document.getElementById('modifyPasswordForm').style.display = 'none';
        }

        async function saveNewPassword() {
            const newPassword = document.getElementById('newPassword').value;

            if (!newPassword || newPassword.length < 4) {
                showToast('Le mot de passe doit contenir au moins 4 caract√®res', 'error');
                return;
            }

            try {
                await api.patch(`/accounts/${loggedInUser.id}`, {
                    password: newPassword
                });

                loggedInUser.password = newPassword;
                sessionStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));

                document.getElementById('modifyPasswordForm').style.display = 'none';
                
                // Mettre √† jour l'affichage si visible
                if (passwordVisible) {
                    document.getElementById('displayPassword').textContent = newPassword;
                }

                showToast('Mot de passe modifi√© avec succ√®s !');

            } catch (error) {
                console.error('Erreur modification:', error);
                showToast('Erreur lors de la modification', 'error');
            }
        }

        function logoutUser() {
            loggedInUser = null;
            sessionStorage.removeItem('loggedInUser');
            
            // R√©initialiser le clientId par d√©faut
            document.getElementById('userId').textContent = '12345';
            
            // Afficher le formulaire de connexion
            document.getElementById('authForm').style.display = 'block';
            document.getElementById('userProfile').style.display = 'none';
            
            // Vider les champs
            document.getElementById('loginPseudo').value = '';
            document.getElementById('loginPassword').value = '';
            
            // Recharger les donn√©es
            loadUserPoints();
            loadPointsHistory();
            
            // R√©g√©n√©rer le QR code
            document.getElementById('qrcode').innerHTML = '';
            generateUserQR();
            
            showToast('D√©connexion r√©ussie');
        }

        // ============================================
        // GESTION DES UTILISATEURS
        // ============================================
        
        async function loadUserPoints() {
            const userId = document.getElementById('userId').textContent;
            
            try {
                // Chercher l'utilisateur par son ID client
                const users = await api.get(`/users?clientId=${userId}`);
                
                if (users.length > 0) {
                    currentUser = users[0];
                } else {
                    // Cr√©er un nouvel utilisateur
                    currentUser = await api.post('/users', {
                        clientId: userId,
                        points: 0,
                        createdAt: new Date().toISOString()
                    });
                }
                
                updatePointsDisplay();
                
            } catch (error) {
                console.error('Erreur chargement utilisateur:', error);
                showToast('Erreur de chargement des points', 'error');
            }
        }

        async function saveUserPoints() {
            if (!currentUser) return;
            
            try {
                await api.patch(`/users/${currentUser.id}`, {
                    points: currentUser.points
                });
                updatePointsDisplay();
            } catch (error) {
                console.error('Erreur sauvegarde points:', error);
                showToast('Erreur de sauvegarde', 'error');
            }
        }

        function updatePointsDisplay() {
            if (currentUser) {
                document.getElementById('userPoints').textContent = currentUser.points;
            }
        }

        // ============================================
        // NAVIGATION
        // ============================================
        
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            // D√©sactiver le mode Super Admin quand on change d'onglet
            if (isSuperAdmin) {
                isSuperAdmin = false;
                document.body.classList.remove('dark-mode');
            }

            if (sectionId === 'profile') {
                loadPointsHistory();
            } else if (sectionId === 'clickcollect') {
                updateCCCart();
            } else if (sectionId === 'prepare') {
                updatePrepareCart();
            } else if (sectionId === 'admin') {
                // R√©initialiser l'√©cran admin (afficher le login)
                document.getElementById('adminLogin').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('superAdminPanel').style.display = 'none';
                document.getElementById('adminCode').value = '';
            } else if (sectionId === 'rewards') {
                updateRewardsSection();
            }
        }

        // ============================================
        // HISTORIQUE DES POINTS
        // ============================================
        
        async function loadPointsHistory() {
            const historyDiv = document.getElementById('pointsHistory');
            const clientId = document.getElementById('userId').textContent;
            
            try {
                // R√©cup√©rer les commandes et r√©compenses de l'utilisateur
                const [orders, rewards] = await Promise.all([
                    api.get(`/orders?clientId=${clientId}`),
                    api.get(`/rewards?clientId=${clientId}`)
                ]);

                // Combiner et trier par date (plus r√©cent en premier)
                const history = [
                    ...orders.map(order => ({
                        type: order.type === 'clickcollect' ? 'clickcollect' : 'prepare',
                        items: order.items || [],
                        points: order.points,
                        date: order.createdAt || order.completedAt,
                        isPositive: true
                    })),
                    ...rewards.map(reward => ({
                        type: 'reward',
                        items: [{ name: reward.type === 'free_drink' ? 'Boisson offerte' : 'R√©compense' }],
                        points: reward.pointsCost,
                        date: reward.redeemedAt,
                        isPositive: false
                    }))
                ].sort((a, b) => new Date(b.date) - new Date(a.date));

                if (history.length === 0) {
                    historyDiv.innerHTML = `
                        <div class="history-empty">
                            üìã Aucun historique pour le moment.<br>
                            Passez une commande pour gagner des points !
                        </div>
                    `;
                    return;
                }

                historyDiv.innerHTML = history.map(entry => {
                    const typeLabel = getTypeLabel(entry.type);
                    const typeClass = entry.type;
                    const pointsSign = entry.isPositive ? '+' : '-';
                    const pointsClass = entry.isPositive ? '' : 'negative';
                    const formattedDate = formatDate(entry.date);
                    const itemsList = entry.items && entry.items.length > 0 
                        ? entry.items.map(item => item.name).join(', ')
                        : 'Aucun article';

                    return `
                        <div class="history-card ${typeClass}">
                            <div class="history-header">
                                <span class="history-type ${typeClass}">${typeLabel}</span>
                                <span class="history-points ${pointsClass}">${pointsSign}${entry.points} pts</span>
                            </div>
                            <div class="history-date">üìÖ ${formattedDate}</div>
                            <div class="history-items">üõí ${itemsList}</div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Erreur chargement historique:', error);
                historyDiv.innerHTML = `
                    <div class="history-empty">
                        ‚ö†Ô∏è Erreur de chargement de l'historique.<br>
                        V√©rifiez la connexion au serveur.
                    </div>
                `;
            }
        }

        function getTypeLabel(type) {
            switch(type) {
                case 'clickcollect': return 'üñ±Ô∏è Click & Collect';
                case 'prepare': return 'üì± Pr√©paration';
                case 'reward': return 'üéÅ R√©compense';
                default: return 'üìã Commande';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'Date inconnue';
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ============================================
        // QR CODE PROFIL
        // ============================================
        
        function generateUserQR() {
            const userId = document.getElementById('userId').textContent;
            new QRCode(document.getElementById("qrcode"), {
                text: userId,
                width: 200,
                height: 200
            });
        }

        // ============================================
        // MENU
        // ============================================
        
        function displayMenu() {
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = menuItems.map(item => `
                <div class="menu-item">
                    <h3>${item.name}</h3>
                    <p>Prix: ${item.price.toFixed(2)}‚Ç¨</p>
                    <p>Points: ${item.points}</p>
                    <button onclick="addToCC(${item.id})">Ajouter au Click & Collect</button>
                    <button onclick="addToPrepare(${item.id})">Ajouter √† ma commande</button>
                </div>
            `).join('');
        }

        // ============================================
        // CLICK & COLLECT
        // ============================================
        
        function addToCC(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            ccCart.push({...item});
            showToast(`${item.name} ajout√© - Commande en cours`, 'preparing');
        }

        function updateCCCart() {
            const cartDiv = document.getElementById('ccCart');
            if (ccCart.length === 0) {
                cartDiv.innerHTML = '<p>Votre panier est vide</p>';
                document.getElementById('ccTotal').style.display = 'none';
                document.getElementById('ccPaymentBtns').style.display = 'none';
                return;
            }

            let total = 0;
            let totalPoints = 0;

            cartDiv.innerHTML = ccCart.map((item, index) => {
                total += item.price;
                totalPoints += item.points;
                return `
                    <div class="cart-item">
                        <span>${item.name} - ${item.price.toFixed(2)}‚Ç¨ (${item.points} pts)</span>
                        <button onclick="removeFromCC(${index})">Retirer</button>
                    </div>
                `;
            }).join('');

            document.getElementById('ccTotalPrice').textContent = total.toFixed(2);
            document.getElementById('ccTotalPoints').textContent = totalPoints;
            document.getElementById('ccTotal').style.display = 'block';
            document.getElementById('ccPaymentBtns').style.display = 'flex';
        }

        function removeFromCC(index) {
            ccCart.splice(index, 1);
            updateCCCart();
        }

        async function validateClickCollect(paymentMethod) {
            if (ccCart.length === 0) return;

            const totalPoints = ccCart.reduce((sum, item) => sum + item.points, 0);
            const totalPrice = ccCart.reduce((sum, item) => sum + item.price, 0);

            const paymentLabel = paymentMethod === 'bancontact' ? 'üí≥ Bancontact' : 'üíµ Esp√®ces';

            try {
                // Cr√©er la commande sur le serveur - DIRECTEMENT PAY√âE ET COMPL√âT√âE
                const order = await api.post('/orders', {
                    type: 'clickcollect',
                    userId: currentUser ? currentUser.id : null,
                    clientId: document.getElementById('userId').textContent,
                    items: [...ccCart],
                    total: totalPrice,
                    points: totalPoints,
                    paymentMethod: paymentMethod,
                    status: 'completed',
                    paid: true,
                    paidAt: new Date().toISOString(),
                    createdAt: new Date().toISOString(),
                    completedAt: new Date().toISOString()
                });

                // Mettre √† jour les points utilisateur
                if (currentUser) {
                    currentUser.points += totalPoints;
                    await saveUserPoints();
                }

                document.getElementById('ccSuccess').innerHTML = `
                    <div class="success-message">
                        ‚úÖ Commande #${order.id} pay√©e et valid√©e !<br>
                        üí∞ Paiement: ${paymentLabel}<br>
                        +${totalPoints} points ajout√©s √† votre compte.<br>
                        Votre commande sera pr√™te sous 15 minutes.
                    </div>
                `;
                document.getElementById('ccSuccess').style.display = 'block';

                showToast('Paiement effectu√© avec succ√®s !');

                ccCart = [];
                updateCCCart();

                setTimeout(() => {
                    document.getElementById('ccSuccess').style.display = 'none';
                }, 5000);

            } catch (error) {
                showToast('Erreur lors de la validation', 'error');
            }
        }

        // ============================================
        // PREPARER MA COMMANDE
        // ============================================
        
        function addToPrepare(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            prepareCart.push({...item});
            showToast(`${item.name} ajout√© au panier`);
        }

        function updatePrepareCart() {
            const cartDiv = document.getElementById('prepareCart');
            if (prepareCart.length === 0) {
                cartDiv.innerHTML = '<p>Votre panier est vide</p>';
                document.getElementById('prepareTotal').style.display = 'none';
                document.getElementById('prepareValidateBtn').style.display = 'none';
                return;
            }

            let total = 0;
            let totalPoints = 0;

            cartDiv.innerHTML = prepareCart.map((item, index) => {
                total += item.price;
                totalPoints += item.points;
                return `
                    <div class="cart-item">
                        <span>${item.name} - ${item.price.toFixed(2)}‚Ç¨ (${item.points} pts)</span>
                        <button onclick="removeFromPrepare(${index})">Retirer</button>
                    </div>
                `;
            }).join('');

            document.getElementById('prepareTotalPrice').textContent = total.toFixed(2);
            document.getElementById('prepareTotalPoints').textContent = totalPoints;
            document.getElementById('prepareTotal').style.display = 'block';
            document.getElementById('prepareValidateBtn').style.display = 'block';
        }

        function removeFromPrepare(index) {
            prepareCart.splice(index, 1);
            updatePrepareCart();
        }

        async function generateOrderQR() {
            if (prepareCart.length === 0) return;

            try {
                const orderData = {
                    type: 'pending',
                    userId: currentUser ? currentUser.id : null,
                    clientId: document.getElementById('userId').textContent,
                    items: prepareCart,
                    total: prepareCart.reduce((sum, item) => sum + item.price, 0),
                    points: prepareCart.reduce((sum, item) => sum + item.points, 0),
                    status: 'waiting_payment',
                    createdAt: new Date().toISOString()
                };

                // Sauvegarder la commande en attente sur le serveur
                const savedOrder = await api.post('/pendingOrders', orderData);

                // QR code simplifi√© : uniquement l'ID de la commande
                const qrData = `ORDER:${savedOrder.id}`;

                document.getElementById('orderQRCode').innerHTML = '';
                new QRCode(document.getElementById("orderQRCode"), {
                    text: qrData,
                    width: 200,
                    height: 200,
                    correctLevel: QRCode.CorrectLevel.L
                });

                document.getElementById('orderQRSection').style.display = 'block';
                showToast('QR Code g√©n√©r√© avec succ√®s !');

                // Vider le panier apr√®s g√©n√©ration
                prepareCart = [];
                updatePrepareCart();

            } catch (error) {
                showToast('Erreur lors de la g√©n√©ration du QR', 'error');
            }
        }

        // ============================================
        // ADMIN
        // ============================================
        
        let isSuperAdmin = false;

        function loginAdmin() {
            const code = document.getElementById('adminCode').value;
            
            if (code === '123') {
                // Admin normal
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('superAdminPanel').style.display = 'none';
                isSuperAdmin = false;
                document.body.classList.remove('dark-mode');
                loadAdminOrders();
                
            } else if (code === '1234') {
                // Super Admin - Mode sombre
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('superAdminPanel').style.display = 'block';
                isSuperAdmin = true;
                document.body.classList.add('dark-mode');
                loadSuperAdminData();
                showToast('üîí Mode Super Admin activ√©');
                
            } else {
                alert('Code incorrect');
            }
        }

        // Charger toutes les donn√©es pour le Super Admin
        async function loadSuperAdminData() {
            await loadSuperAdminStats();
            await loadSuperAdminOrders();
            await loadSuperAdminUsers();
        }

        // Statistiques globales
        async function loadSuperAdminStats() {
            try {
                const users = await api.get('/users');
                const orders = await api.get('/orders');
                const accounts = await api.get('/accounts');
                
                // Calculer les stats
                const totalUsers = accounts.length;
                const totalOrders = orders.length;
                const totalRevenue = orders.reduce((sum, o) => sum + (o.total || 0), 0);
                const totalPoints = orders.reduce((sum, o) => sum + (o.points || 0), 0);
                
                document.getElementById('statTotalUsers').textContent = totalUsers;
                document.getElementById('statTotalOrders').textContent = totalOrders;
                document.getElementById('statTotalRevenue').textContent = totalRevenue.toFixed(2) + '‚Ç¨';
                document.getElementById('statTotalPoints').textContent = totalPoints;
                
            } catch (error) {
                console.error('Erreur chargement stats:', error);
            }
        }

        // Toutes les commandes
        async function loadSuperAdminOrders() {
            const ordersDiv = document.getElementById('superAdminOrders');
            
            try {
                const orders = await api.get('/orders');
                
                if (orders.length === 0) {
                    ordersDiv.innerHTML = '<p style="color: #9ca3af;">Aucune commande enregistr√©e</p>';
                    return;
                }

                // Trier par date d√©croissante
                orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                ordersDiv.innerHTML = orders.map(order => `
                    <div class="order-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <strong>Commande #${order.id}</strong>
                            <span style="background: ${order.status === 'completed' ? '#4caf50' : '#ff9800'}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">
                                ${order.status === 'completed' ? '‚úì Termin√©e' : '‚è≥ En cours'}
                            </span>
                        </div>
                        <p style="color: #9ca3af; margin: 8px 0;">${new Date(order.createdAt).toLocaleString()}</p>
                        <p><strong>Client:</strong> ${order.clientId || 'Anonyme'}</p>
                        <div class="order-items">
                            ${order.items ? order.items.map(item => `${item.name}`).join(', ') : 'D√©tails non disponibles'}
                        </div>
                        <p><strong>Total:</strong> ${order.total ? order.total.toFixed(2) : '0.00'}‚Ç¨ | <strong>Points:</strong> ${order.points || 0}</p>
                        ${order.status !== 'completed' ? `
                            <button class="btn-primary" style="margin-top:10px; font-size: 14px; padding: 10px 20px;" onclick="markOrderComplete(${order.id}); loadSuperAdminData();">
                                Marquer comme termin√©e
                            </button>
                        ` : ''}
                    </div>
                `).join('');

            } catch (error) {
                ordersDiv.innerHTML = '<p style="color: #fca5a5;">Erreur de chargement des commandes</p>';
            }
        }

        // Liste des utilisateurs
        async function loadSuperAdminUsers() {
            const usersDiv = document.getElementById('superAdminUsers');
            
            try {
                const accounts = await api.get('/accounts');
                const users = await api.get('/users');
                
                if (accounts.length === 0) {
                    usersDiv.innerHTML = '<p style="color: #9ca3af;">Aucun utilisateur inscrit</p>';
                    return;
                }

                usersDiv.innerHTML = accounts.map(account => {
                    const userPoints = users.find(u => u.clientId === account.clientId);
                    const points = userPoints ? userPoints.points : 0;
                    
                    return `
                        <div class="order-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                                <strong>üë§ ${account.pseudo}</strong>
                                <span style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px;">
                                    ${points} points
                                </span>
                            </div>
                            <p style="color: #9ca3af; margin: 8px 0; font-size: 12px;">ID: ${account.clientId}</p>
                            <p style="color: #6b7280; font-size: 12px;">Inscrit le: ${new Date(account.createdAt).toLocaleDateString()}</p>
                            <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn-primary" style="font-size: 12px; padding: 8px 16px;" onclick="addPointsToUser('${account.clientId}', 10)">
                                    +10 points
                                </button>
                                <button class="btn-primary" style="font-size: 12px; padding: 8px 16px; background: #ff9800;" onclick="addPointsToUser('${account.clientId}', -10)">
                                    -10 points
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                usersDiv.innerHTML = '<p style="color: #fca5a5;">Erreur de chargement des utilisateurs</p>';
            }
        }

        // Ajouter/retirer des points √† un utilisateur
        async function addPointsToUser(clientId, points) {
            try {
                const users = await api.get(`/users?clientId=${clientId}`);
                
                if (users.length > 0) {
                    const user = users[0];
                    const newPoints = Math.max(0, user.points + points);
                    
                    await api.patch(`/users/${user.id}`, { points: newPoints });
                    
                    showToast(`${points > 0 ? '+' : ''}${points} points pour ${clientId}`);
                    loadSuperAdminData();
                }
            } catch (error) {
                showToast('Erreur lors de la modification', 'error');
            }
        }

        // Zone danger - R√©initialiser tous les points
        async function resetAllPoints() {
            if (!confirm('‚ö†Ô∏è ATTENTION: Vous √™tes sur le point de r√©initialiser TOUS les points de TOUS les utilisateurs √† 0. Cette action est IRR√âVERSIBLE.\n\n√ätes-vous s√ªr de vouloir continuer ?')) {
                return;
            }
            
            try {
                const users = await api.get('/users');
                
                for (const user of users) {
                    await api.patch(`/users/${user.id}`, { points: 0 });
                }
                
                showToast('Tous les points ont √©t√© r√©initialis√©s');
                loadSuperAdminData();
                
            } catch (error) {
                showToast('Erreur lors de la r√©initialisation', 'error');
            }
        }

        // Zone danger - Supprimer toutes les commandes
        async function clearAllOrders() {
            if (!confirm('‚ö†Ô∏è ATTENTION: Vous √™tes sur le point de supprimer TOUTES les commandes. Cette action est IRR√âVERSIBLE.\n\n√ätes-vous s√ªr de vouloir continuer ?')) {
                return;
            }
            
            try {
                const orders = await api.get('/orders');
                const pendingOrders = await api.get('/pendingOrders');
                
                for (const order of orders) {
                    await api.delete(`/orders/${order.id}`);
                }
                
                for (const order of pendingOrders) {
                    await api.delete(`/pendingOrders/${order.id}`);
                }
                
                showToast('Toutes les commandes ont √©t√© supprim√©es');
                loadSuperAdminData();
                
            } catch (error) {
                showToast('Erreur lors de la suppression', 'error');
            }
        }

        // Exporter les donn√©es
        async function exportAllData() {
            try {
                const users = await api.get('/users');
                const accounts = await api.get('/accounts');
                const orders = await api.get('/orders');
                const rewards = await api.get('/rewards');
                
                const exportData = {
                    exportDate: new Date().toISOString(),
                    users,
                    accounts: accounts.map(a => ({ ...a, password: '***' })), // Masquer les mots de passe
                    orders,
                    rewards
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `canadian-burger-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Donn√©es export√©es avec succ√®s !');
                
            } catch (error) {
                showToast('Erreur lors de l\'export', 'error');
            }
        }

        async function loadAdminOrders() {
            const ordersDiv = document.getElementById('adminOrders');

            try {
                const orders = await api.get('/orders?status=pending');

                if (orders.length === 0) {
                    ordersDiv.innerHTML = '<p>Aucune commande en cours</p>';
                    return;
                }

                ordersDiv.innerHTML = orders.map(order => `
                    <div class="order-card">
                        <strong>Commande #${order.id}</strong><br>
                        ${new Date(order.createdAt).toLocaleString()}<br>
                        <div class="order-items">
                            ${order.items.map(item => `${item.name}`).join(', ')}
                        </div>
                        Total: ${order.total.toFixed(2)}‚Ç¨ | Points accord√©s: ${order.points}<br>
                        <button class="btn-primary" style="margin-top:10px;" onclick="markOrderComplete(${order.id})">Marquer comme termin√©e</button>
                    </div>
                `).join('');

            } catch (error) {
                ordersDiv.innerHTML = '<p>Erreur de chargement des commandes</p>';
            }
        }

        async function markOrderComplete(orderId) {
            try {
                await api.patch(`/orders/${orderId}`, {
                    status: 'completed',
                    completedAt: new Date().toISOString()
                });
                
                loadAdminOrders();
                showToast('Commande marqu√©e comme termin√©e');
                
            } catch (error) {
                showToast('Erreur lors de la mise √† jour', 'error');
            }
        }

        function startScanner() {
            const readerDiv = document.getElementById('reader');
            readerDiv.style.display = 'block';

            if (html5QrCode) {
                html5QrCode.stop();
            }

            html5QrCode = new Html5Qrcode("reader");

            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                onScanSuccess
            ).catch(err => {
                alert("Erreur cam√©ra: " + err);
            });
        }

        async function onScanSuccess(decodedText) {
            try {
                html5QrCode.stop();
                document.getElementById('reader').style.display = 'none';

                // V√©rifier si c'est le nouveau format simplifi√©
                if (decodedText.startsWith('ORDER:')) {
                    const orderId = decodedText.replace('ORDER:', '');
                    
                    // R√©cup√©rer les donn√©es depuis le serveur
                    const orderData = await api.get(`/pendingOrders/${orderId}`);
                    displayScannedOrder(orderData);
                    
                } else {
                    // Ancien format JSON (r√©trocompatibilit√©)
                    const orderData = JSON.parse(decodedText);
                    displayScannedOrder(orderData);
                }
                
            } catch (e) {
                console.error('Erreur scan:', e);
                showToast('QR code invalide ou commande introuvable', 'error');
            }
        }

        function displayScannedOrder(orderData) {
            const section = document.getElementById('scannedOrderSection');
            const orderId = orderData.id || orderData.orderId;
            const itemsJson = encodeURIComponent(JSON.stringify(orderData.items));
            
            section.innerHTML = `
                <div class="scanned-order">
                    <h3>Commande scann√©e</h3>
                    <p><strong>Client ID:</strong> ${orderData.clientId}</p>
                    <p><strong>Commande #${orderId}</strong></p>
                    <div class="order-items">
                        ${orderData.items.map(item => `<p>${item.name} - ${item.price.toFixed(2)}‚Ç¨</p>`).join('')}
                    </div>
                    <p><strong>Total:</strong> ${orderData.total.toFixed(2)}‚Ç¨</p>
                    <p><strong>Points √† cr√©diter:</strong> ${orderData.points}</p>
                    <button class="btn-primary" onclick="validateScannedOrder(${orderData.points}, ${orderId}, '${orderData.clientId}', '${itemsJson}', ${orderData.total})">
                        Valider la commande
                    </button>
                </div>
            `;
        }

        async function validateScannedOrder(points, orderId, clientId, itemsJson, total) {
            try {
                const items = JSON.parse(decodeURIComponent(itemsJson));
                
                // Trouver l'utilisateur par clientId
                const users = await api.get(`/users?clientId=${clientId}`);
                
                if (users.length > 0) {
                    const user = users[0];
                    // Cr√©diter les points
                    await api.patch(`/users/${user.id}`, {
                        points: user.points + points
                    });
                }

                // Supprimer la commande en attente
                try {
                    await api.delete(`/pendingOrders/${orderId}`);
                } catch (e) {
                    // La commande n'existe peut-√™tre pas
                }

                // Cr√©er une commande valid√©e avec tous les d√©tails
                await api.post('/orders', {
                    type: 'prepare',
                    clientId: clientId,
                    items: items,
                    total: total,
                    points: points,
                    status: 'completed',
                    createdAt: new Date().toISOString(),
                    completedAt: new Date().toISOString()
                });

                // Mettre √† jour l'affichage local si c'est le m√™me utilisateur
                if (currentUser && currentUser.clientId === clientId) {
                    currentUser.points += points;
                    updatePointsDisplay();
                }

                document.getElementById('scannedOrderSection').innerHTML = `
                    <div class="success-message">
                        ‚úÖ Commande valid√©e et pay√©e ! ${points} points cr√©dit√©s.
                    </div>
                `;

                showToast(`${points} points cr√©dit√©s au client !`);

            } catch (error) {
                showToast('Erreur lors de la validation', 'error');
            }
        }

        // ============================================
        // RECOMPENSES
        // ============================================
        
        function updateRewardsSection() {
            const points = currentUser ? currentUser.points : 0;
            document.getElementById('rewardsPoints').textContent = points;
            const redeemBtn = document.getElementById('redeemBtn');
            
            if (points >= 50) {
                redeemBtn.disabled = false;
                redeemBtn.textContent = '√âchanger';
            } else {
                redeemBtn.disabled = true;
                redeemBtn.textContent = `Plus que ${50 - points} points`;
            }
        }

        async function redeemReward() {
            if (!currentUser || currentUser.points < 50) {
                alert('Vous n\'avez pas assez de points');
                return;
            }

            try {
                currentUser.points -= 50;
                await saveUserPoints();

                // Enregistrer la r√©compense
                await api.post('/rewards', {
                    userId: currentUser.id,
                    clientId: currentUser.clientId,
                    type: 'free_drink',
                    pointsCost: 50,
                    redeemedAt: new Date().toISOString(),
                    status: 'pending'
                });
                
                document.getElementById('rewardSuccess').innerHTML = `
                    <div class="success-message">
                        üéâ F√©licitations ! Vous avez obtenu une boisson offerte !<br>
                        Pr√©sentez votre profil √† la caisse pour r√©cup√©rer votre r√©compense.
                    </div>
                `;
                document.getElementById('rewardSuccess').style.display = 'block';

                updateRewardsSection();

                setTimeout(() => {
                    document.getElementById('rewardSuccess').style.display = 'none';
                }, 5000);

            } catch (error) {
                showToast('Erreur lors de l\'√©change', 'error');
            }
        }

        // ============================================
        // UTILITAIRES
        // ============================================
        
        function showToast(message, type = '') {
            const toast = document.createElement('div');
            toast.className = 'toast' + (type ? ' ' + type : '');
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html>
